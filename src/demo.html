<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    

 <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script type="text/javascript" src="playerapi.js"></script>

    <script>

        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                    results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }
    </script>
    <style>
        .row {
            margin-top: 10px;
        }
    </style>

</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h3>Lemonwhale Player API Demo</h3>
        </div>
        <div class="col-md-12">
            This demo uses Lemonwhale Player API that is available on Github and can be used to communicate with Lemonwhale Flash and HTML5 players. More documentation of the API can be found <a href="https://github.com/Lemonwhale-AB/Lemonwhale-Player-API/">here</a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
         <form class="form"> 
             <div class="form-group">
                <div class="input-group">
                   <label for="media-input">Media Id</label> 
                  <input type="text" class="form-control input-small" id="media-input" value="8ac85551-dd93-4b6f-8a19-c032fcd1e603">
                </div>
              </div>

             <div class="form-group">
                <div class="input-group">
                   <label for="instance-input">Player Id</label> 
                  <input type="text" class="form-control" id="instance-input" value="86198320-5762-4625-bc4b-6405444f0921">
                </div>
              </div>
             <div class="form-group">
                <div class="input-group">
                   <label for="starttime-input">Starttime (In seconds)</label> 
                  <input type="text" class="form-control input-small" id="starttime-input" value="0">
                </div>
              </div>
         <div class="form-group">               
              <div class="checkbox">
                <label>
                  <input type="checkbox" id='autoplay-checkbox'> Autoplay
                </label>
              </div>

              <div class="checkbox">
                <label>
                  <input type="checkbox" id='flash-checkbox'> Flash (Use Flash player instead of HTML5)
                </label>
              </div>
                <button type="button" id="update-player-btn" class="btn btn-default">Update Player</button>
              </div>
              </form>
        </div>
    </div>
    <div class="row">
        <div class="col-md-8">
            <!-- 16:9 aspect ratio -->
            <div class="embed-responsive embed-responsive-16by9">
                <iframe id="player-1" class="embed-responsive-item" src="http://pineapple.lwdns.net/api/video/embed.jsp?id=1e84d59b-c9d7-4b90-b0b5-e2165daf3466&pi=48dfb1a2-ed9c-494d-993f-f036a85ca0ea&html5=1" allowfullscreen mozallowfullscreen webkitallowfullscreen></iframe>
            </div>
        </div>
        <div class="col-md-4" >
            <textarea class="form-control" rows="18" id="print"></textarea>
            <button class="btn btn-default" id='btn-reset-log' style="margin-top:10px">Reset Log</button>
        </div>
    </div>
    <div class="row">
        <div class="col-md-8">
            <button class="btn btn-primary" id='btn-play'>Play</button>
            <button class="btn btn-primary" id='btn-pause'>Pause</button>
            <button class="btn btn-primary" id='btn-isplaying'>getIsPlaying</button>
            <button class="btn btn-primary" id='btn-getvolume'>getVolume</button>
            <button class="btn btn-primary" id='btn-duration'>getDuration</button>
            <button class="btn btn-primary" id='btn-getPos'>getPosition</button>
            <button class="btn btn-primary" id='btn-getislive'>getIsLive</button>
            <button class="btn btn-primary" id='btn-getmediainfo'>getMediaInfo</button>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
         <form class="form-inline"> 
             <div class="form-group">
                <div class="input-group">
                  <input type="text" class="form-control" id="volume-input" placeholder="Volume 0-1.0">
                </div>
                <button type="button" id="btn-set-volume" class="btn btn-primary">setVolume</button>
              </div>

             <div class="form-group">
                <div class="input-group">
                  <input type="text" class="form-control" id="position-input" placeholder="Position in Seconds">
                </div>
                <button type="button" id="btn-set-position" class="btn btn-primary">setPosition</button>
              </div>
        </form>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
         <form class="form-inline"> 
             <div class="form-group">
                <div class="input-group">
                  <input type="text" class="form-control input-small" id="up-input" placeholder="Up color">
                </div>
                <button type="button" id="btn-set-upcolor" class="btn btn-primary">setUpColor</button>
              </div>

             <div class="form-group">
                <div class="input-group">
                  <input type="text" class="form-control" id="hover-input" placeholder="Hover color">
                </div>
                <button type="button" id="btn-set-hovercolor" class="btn btn-primary">setHoverColor</button>
              </div>
        </form>
        </div>
    </div>
   
</div>

<script>

            (function(){
                // Listen for the ready event for any vimeo video players on the page
                var players = document.querySelectorAll('iframe'),
                    player;
                for (var i = 0, length = players.length; i < length; i++) {
                    player = players[i];
                    $f(player).addEvent('ready', ready);
                }
                /**
                 * Utility function for adding an event. Handles the inconsistencies
                 * between the W3C method for adding events (addEventListener) and
                 * IE's (attachEvent).
                 */
                function addEvent(element, eventName, callback) {
                    if (element.addEventListener) {
                        element.addEventListener(eventName, callback, false);
                    }
                    else {
                        element.attachEvent(eventName, callback, false);
                    }
                }
                  function setupLogging(){     
                        document.getElementById('btn-reset-log').addEventListener("click", function(){

                            document.getElementById("print").value = '';    
                        });


                        function listener(event){
                             console.log('listerner')
                                var data = '';
                                var jsonData = event.data
                                if(jsonData.data !== undefined){
                                    for(var i=0 ;i<jsonData.data.length;i++){
                                        data += jsonData.data[i] + "\t";
                                    }
                                }
                                
                                var newcontent  = "received: "+jsonData.method+" "+data;
                                document.getElementById("print").value = ( newcontent +'\n' + document.getElementById("print").value ) ;
                        }

                        if (window.addEventListener){
                            addEventListener("message", listener, false)
                        } else {
                            attachEvent("onmessage", listener)
                        }
                    };

                    setupLogging();

                /**
                 * Called once a vimeo player is loaded and ready to receive
                 * commands. You can add events and make api calls only after this
                 * function has been called.
                 */
                function ready(player_id) {

                    if(player_id==undefined || player_id.length==0){
                        player_id = 'player-1';
                    }
                    // Keep a reference to LemonwhaleAPI for this player
                    var container = document.body,
                        playerAPI = $f(player_id);

                    function setupSimpleButtons() {
                        var buttons = container.querySelector('div dl.simple'),
                            playBtn = document.getElementById("btn-play"),
                            pauseBtn = document.getElementById("btn-pause"),
                            getPositionBtn = document.getElementById("btn-getPos"), 
                            isPlayingBtn = document.getElementById("btn-isplaying"), 
                            getVolume = document.getElementById("btn-getvolume"),
                            getDuration = document.getElementById("btn-duration"),
                            getMediaInfo = document.getElementById("btn-getmediainfo"),
                            getIsLive = document.getElementById("btn-getislive"),
                            setPosition = document.getElementById("btn-set-position"),
                            setVolume = document.getElementById("btn-set-volume"),
                            setHoverColor = document.getElementById("btn-set-hovercolor"),
                            setUpColor = document.getElementById("btn-set-upcolor")
                        // Call play when play button clicked
                        addEvent(playBtn, 'click', function() {
                            playerAPI.callPlayer('setIsPlaying',true);
                        }, false);
                        // Call pause when pause button clicked
                        addEvent(pauseBtn, 'click', function() {
                            playerAPI.callPlayer('setIsPlaying',false);
                        }, false);
                        // Ask player for position in Video
                        addEvent(getPositionBtn, 'click', function() {
                            playerAPI.callPlayer('getPosition');
                        }, false);
                        // Ask player if media is playing
                        addEvent(isPlayingBtn, 'click', function() {
                            playerAPI.callPlayer('getIsPlaying');
                        }, false);
                        // Ask player if media is playing
                        addEvent(getVolume, 'click', function() {
                            playerAPI.callPlayer('getVolume');
                        }, false);
                        // Ask player for duration
                        addEvent(getDuration, 'click', function() {
                            playerAPI.callPlayer('getDuration');
                        }, false);
                        // Ask player for media info
                        addEvent(getMediaInfo, 'click', function() {
                            playerAPI.callPlayer('getMediaInfo');
                        }, false);

                        // Ask player if it's a livecast
                        addEvent(getIsLive, 'click', function() {
                            playerAPI.callPlayer('getIsLive');
                        }, false);      

                        // Set playback position
                        addEvent(setPosition, 'click', function() {
                            var value = document.getElementById('position-input').value;
                            playerAPI.callPlayer('setPosition', value);
                        }, false);  

                        // Set volume
                        addEvent(setVolume, 'click', function() {
                            var value = document.getElementById('volume-input').value;
                            playerAPI.callPlayer('setVolume', value);
                        }, false);

                         // Set color on player
                        addEvent(setHoverColor, 'click', function() {
                            var value = document.getElementById('hover-input').value;
                            playerAPI.callPlayer('setHoverColor', value);
                        }, false);    

                         // Set color on player
                        addEvent(setUpColor, 'click', function() {
                            var value = document.getElementById('up-input').value;
                            playerAPI.callPlayer('setUpColor', value);
                        }, false);
                    }

                  
                    function setupPlayerCreation(){
                        document.getElementById('update-player-btn').addEventListener("click", function(){
                            var src = 'http://pineapple.lwdns.net/api/video/embed.jsp?id=';
                            src += document.getElementById('media-input').value;
                            src += '&pi=' + document.getElementById('instance-input').value;
                            src += "&startTime=" + document.getElementById('starttime-input').value;
                            src += "&autoplay=" + document.getElementById('autoplay-checkbox').checked;
                            src += "&html5=" + !document.getElementById('flash-checkbox').checked;

                            document.getElementById('player-1').src = src;   
                         
                        });
                    }


                    setupPlayerCreation();
                    setupSimpleButtons();
                }
            })();
        </script>

</body>
</html>
